App.tsximport React, { useState, useEffect } from "react";
import {
  SafeAreaView,
  View,
  Text,
  TouchableOpacity,
  Modal,
  TextInput,
  Switch,
  FlatList,
  StyleSheet,
  Alert,
  useColorScheme,
  StatusBar,
} from "react-native";

type Note = {
  id: string;
  title: string;
  content: string;
  date: string;
};

type Task = {
  id: string;
  title: string;
  completed: boolean;
  date: string;
};

const getToday = () => {
  const d = new Date();
  const month = d.toLocaleString("id", { month: "long" });
  return `${d.getDate()} ${month}`;
};

const STORAGE_KEY = "APP_DATA_V1";

const defaultData = {
  notes: [] as Note[],
  tasks: [] as Task[],
  darkMode: true,
};

export default function App() {
  const [data, setData] = useState(defaultData);
  const [tab, setTab] = useState<"notes" | "tasks">("notes");
  const [showNoteModal, setShowNoteModal] = useState(false);
  const [showTaskModal, setShowTaskModal] = useState(false);
  const [showSettings, setShowSettings] = useState(false);
  const [noteTitle, setNoteTitle] = useState("");
  const [noteContent, setNoteContent] = useState("");
  const [taskTitle, setTaskTitle] = useState("");
  const [isDark, setIsDark] = useState(defaultData.darkMode);

  // Load from localStorage
  useEffect(() => {
    const d = localStorage.getItem(STORAGE_KEY);
    if (d) {
      const obj = JSON.parse(d);
      setData(obj);
      setIsDark(obj.darkMode);
    }
  }, []);

  // Save to localStorage
  useEffect(() => {
    localStorage.setItem(
      STORAGE_KEY,
      JSON.stringify({ ...data, darkMode: isDark })
    );
  }, [data, isDark]);

  // Note CRUD
  const addNote = () => {
    if (!noteTitle) return;
    setData((prev) => ({
      ...prev,
      notes: [
        ...prev.notes,
        {
          id: Date.now().toString(),
          title: noteTitle,
          content: noteContent,
          date: getToday(),
        },
      ],
    }));
    setNoteTitle("");
    setNoteContent("");
    setShowNoteModal(false);
  };

  const deleteAllNotes = () => {
    Alert.alert("Konfirmasi", "Hapus semua catatan?", [
      { text: "Batal", style: "cancel" },
      {
        text: "Hapus",
        style: "destructive",
        onPress: () =>
          setData((prev) => ({
            ...prev,
            notes: [],
          })),
      },
    ]);
  };

  // Task CRUD
  const addTask = () => {
    if (!taskTitle) return;
    setData((prev) => ({
      ...prev,
      tasks: [
        ...prev.tasks,
        {
          id: Date.now().toString(),
          title: taskTitle,
          completed: false,
          date: getToday(),
        },
      ],
    }));
    setTaskTitle("");
    setShowTaskModal(false);
  };

  const toggleTask = (id: string) => {
    setData((prev) => ({
      ...prev,
      tasks: prev.tasks.map((t) =>
        t.id === id ? { ...t, completed: !t.completed } : t
      ),
    }));
  };

  const deleteAllTasks = () => {
    Alert.alert("Konfirmasi", "Hapus semua tugas?", [
      { text: "Batal", style: "cancel" },
      {
        text: "Hapus",
        style: "destructive",
        onPress: () =>
          setData((prev) => ({
            ...prev,
            tasks: [],
          })),
      },
    ]);
  };

  // Settings
  const toggleTheme = () => setIsDark((d) => !d);

  // Saran pengaturan lain: Reset semua data
  const resetAll = () => {
    Alert.alert("Reset Data", "Hapus semua data aplikasi?", [
      { text: "Batal", style: "cancel" },
      {
        text: "Reset",
        style: "destructive",
        onPress: () => {
          setData(defaultData);
          setIsDark(defaultData.darkMode);
        },
      },
    ]);
  };

  // Styling
  const theme = isDark
    ? {
        bg: "#000",
        text: "#fff",
        card: "#232323",
        input: "#232323",
        tabActive: "#fff",
        tabInactive: "#999",
        fab: "#FFA800",
      }
    : {
        bg: "#fff",
        text: "#000",
        card: "#f3f3f3",
        input: "#eaeaea",
        tabActive: "#000",
        tabInactive: "#bbb",
        fab: "#FFA800",
      };

  return (
    <SafeAreaView style={[styles.safe, { backgroundColor: theme.bg }]}>
      <StatusBar
        barStyle={isDark ? "light-content" : "dark-content"}
        backgroundColor={theme.bg}
      />
      {/* Header */}
      <View style={styles.header}>
        <Text style={[styles.title, { color: theme.text }]}>
          {tab === "notes" ? "Catatan" : "Tugas"}
        </Text>
        <View style={styles.headerIcons}>
          <TouchableOpacity
            onPress={() => setTab(tab === "notes" ? "tasks" : "notes")}
            style={styles.headerIconBtn}
          >
            <Text style={{ color: theme.text, fontSize: 22 }}>
              {tab === "notes" ? "üìÅ" : "üìù"}
            </Text>
          </TouchableOpacity>
          <TouchableOpacity
            onPress={() => setShowSettings(true)}
            style={styles.headerIconBtn}
          >
            <Text style={{ color: theme.text, fontSize: 22 }}>‚öôÔ∏è</Text>
          </TouchableOpacity>
        </View>
      </View>
      {/* Body */}
      <View style={{ flex: 1 }}>
        {tab === "notes" ? (
          <FlatList
            data={data.notes}
            keyExtractor={(item) => item.id}
            ListEmptyComponent={
              <Text style={{ color: theme.text, textAlign: "center", marginTop: 30 }}>
                Belum ada catatan
              </Text>
            }
            renderItem={({ item }) => (
              <View style={[styles.card, { backgroundColor: theme.card }]}>
                <Text style={[styles.cardTitle, { color: theme.text }]}>{item.title}</Text>
                <Text style={{ color: theme.text, opacity: 0.7 }}>
                  {item.content || "Tidak ada teks"}
                </Text>
                <Text style={{ color: theme.text, opacity: 0.5, fontSize: 12 }}>
                  {item.date}
                </Text>
              </View>
            )}
            contentContainerStyle={{ padding: 16 }}
          />
        ) : (
          <FlatList
            data={data.tasks}
            keyExtractor={(item) => item.id}
            ListEmptyComponent={
              <Text style={{ color: theme.text, textAlign: "center", marginTop: 30 }}>
                Belum ada tugas
              </Text>
            }
            renderItem={({ item }) => (
              <TouchableOpacity
                style={[
                  styles.card,
                  { backgroundColor: theme.card, flexDirection: "row", alignItems: "center" },
                ]}
                onPress={() => toggleTask(item.id)}
              >
                <Text
                  style={{
                    color: item.completed ? "#aaa" : theme.text,
                    textDecorationLine: item.completed ? "line-through" : "none",
                    flex: 1,
                  }}
                >
                  {item.title}
                </Text>
                <Text style={{ color: "#FFA800", fontSize: 18 }}>
                  {item.completed ? "‚úîÔ∏è" : "‚¨úÔ∏è"}
                </Text>
                <Text
                  style={{
                    color: theme.text,
                    opacity: 0.5,
                    fontSize: 12,
                    marginLeft: 8,
                  }}
                >
                  {item.date}
                </Text>
              </TouchableOpacity>
            )}
            contentContainerStyle={{ padding: 16 }}
          />
        )}
      </View>
      {/* FAB */}
      <TouchableOpacity
        style={[styles.fab, { backgroundColor: theme.fab }]}
        onPress={() => (tab === "notes" ? setShowNoteModal(true) : setShowTaskModal(true))}
      >
        <Text style={styles.fabText}>+</Text>
      </TouchableOpacity>
      {/* Tab Bar */}
      <View style={[styles.tabBar, { backgroundColor: theme.bg }]}>
        <TouchableOpacity style={styles.tabItem} onPress={() => setTab("notes")}>
          <Text
            style={{
              color: tab === "notes" ? theme.tabActive : theme.tabInactive,
              fontWeight: "bold",
            }}
          >
            Catatan
          </Text>
        </TouchableOpacity>
        <TouchableOpacity style={styles.tabItem} onPress={() => setTab("tasks")}>
          <Text
            style={{
              color: tab === "tasks" ? theme.tabActive : theme.tabInactive,
              fontWeight: "bold",
            }}
          >
            Tugas
          </Text>
        </TouchableOpacity>
      </View>
      {/* Note Modal */}
      <Modal visible={showNoteModal} animationType="slide" transparent>
        <View style={styles.modalBg}>
          <View style={[styles.modalContent, { backgroundColor: theme.bg }]}>
            <Text style={{ color: theme.text, fontWeight: "bold", fontSize: 18 }}>
              Tambah Catatan
            </Text>
            <TextInput
              style={[styles.input, { backgroundColor: theme.input, color: theme.text }]}
              placeholder="Judul"
              placeholderTextColor={isDark ? "#aaa" : "#555"}
              value={noteTitle}
              onChangeText={setNoteTitle}
            />
            <TextInput
              style={[
                styles.input,
                { backgroundColor: theme.input, color: theme.text, height: 80 },
              ]}
              placeholder="Isi Catatan"
              placeholderTextColor={isDark ? "#aaa" : "#555"}
              value={noteContent}
              onChangeText={setNoteContent}
              multiline
            />
            <View style={{ flexDirection: "row", justifyContent: "flex-end" }}>
              <TouchableOpacity onPress={() => setShowNoteModal(false)}>
                <Text style={{ color: "#FFA800", marginRight: 16 }}>Batal</Text>
              </TouchableOpacity>
              <TouchableOpacity onPress={addNote}>
                <Text style={{ color: "#FFA800" }}>Simpan</Text>
              </TouchableOpacity>
            </View>
          </View>
        </View>
      </Modal>
      {/* Task Modal */}
      <Modal visible={showTaskModal} animationType="slide" transparent>
        <View style={styles.modalBg}>
          <View style={[styles.modalContent, { backgroundColor: theme.bg }]}>
            <Text style={{ color: theme.text, fontWeight: "bold", fontSize: 18 }}>
              Tambah Tugas
            </Text>
            <TextInput
              style={[styles.input, { backgroundColor: theme.input, color: theme.text }]}
              placeholder="Judul Tugas"
              placeholderTextColor={isDark ? "#aaa" : "#555"}
              value={taskTitle}
              onChangeText={setTaskTitle}
            />
            <View style={{ flexDirection: "row", justifyContent: "flex-end" }}>
              <TouchableOpacity onPress={() => setShowTaskModal(false)}>
                <Text style={{ color: "#FFA800", marginRight: 16 }}>Batal</Text>
              </TouchableOpacity>
              <TouchableOpacity onPress={addTask}>
                <Text style={{ color: "#FFA800" }}>Simpan</Text>
              </TouchableOpacity>
            </View>
          </View>
        </View>
      </Modal>
      {/* Settings Modal */}
      <Modal visible={showSettings} animationType="slide" transparent>
        <View style={styles.modalBg}>
          <View style={[styles.modalContent, { backgroundColor: theme.bg }]}>
            <Text style={{ color: theme.text, fontWeight: "bold", fontSize: 18, marginBottom: 16 }}>
              Pengaturan
            </Text>
            <View style={styles.settingRow}>
              <Text style={{ color: theme.text, flex: 1 }}>Mode Gelap</Text>
              <Switch value={isDark} onValueChange={toggleTheme} />
            </View>
            <TouchableOpacity style={styles.settingRow} onPress={deleteAllNotes}>
              <Text style={{ color: "#ff3333", flex: 1 }}>Hapus Semua Catatan</Text>
            </TouchableOpacity>
            <TouchableOpacity style={styles.settingRow} onPress={deleteAllTasks}>
              <Text style={{ color: "#ff3333", flex: 1 }}>Hapus Semua Tugas</Text>
            </TouchableOpacity>
            <TouchableOpacity style={styles.settingRow} onPress={resetAll}>
              <Text style={{ color: "#ff3333", flex: 1 }}>Reset Semua Data</Text>
            </TouchableOpacity>
            <TouchableOpacity
              style={{ alignSelf: "flex-end", marginTop: 24 }}
              onPress={() => setShowSettings(false)}
            >
              <Text style={{ color: "#FFA800" }}>Tutup</Text>
            </TouchableOpacity>
          </View>
        </View>
      </Modal>
    </SafeAreaView>
  );
}

const styles = StyleSheet.create({
  safe: { flex: 1 },
  header: {
    flexDirection: "row",
    alignItems: "center",
    padding: 16,
    justifyContent: "space-between",
  },
  title: { fontSize: 32, fontWeight: "bold" },
  headerIcons: { flexDirection: "row" },
  headerIconBtn: { marginLeft: 16 },
  card: {
    borderRadius: 18,
    padding: 20,
    marginBottom: 18,
    minHeight: 80,
    elevation: 1,
  },
  cardTitle: {
    fontWeight: "bold",
    fontSize: 20,
    marginBottom: 4,
  },
  fab: {
    position: "absolute",
    bottom: 70,
    right: 24,
    width: 60,
    height: 60,
    borderRadius: 30,
    alignItems: "center",
    justifyContent: "center",
    elevation: 5,
  },
  fabText: { color: "#fff", fontSize: 32, fontWeight: "bold" },
  tabBar: {
    flexDirection: "row",
    justifyContent: "space-around",
    paddingVertical: 8,
    borderTopWidth: 0.5,
    borderTopColor: "#222",
  },
  tabItem: {
    flex: 1,
    alignItems: "center",
    paddingVertical: 8,
  },
  modalBg: {
    flex: 1,
    backgroundColor: "#0009",
    justifyContent: "center",
    alignItems: "center",
  },
  modalContent: {
    width: "90%",
    borderRadius: 18,
    padding: 24,
    elevation: 5,
  },
  input: {
    borderRadius: 12,
    padding: 12,
    marginVertical: 12,
    fontSize: 16,
  },
  settingRow: {
    flexDirection: "row",
    alignItems: "center",
    paddingVertical: 12,
    borderBottomWidth: 0.5,
    borderBottomColor: "#333",
  },
});
