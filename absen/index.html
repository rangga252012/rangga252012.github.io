<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kalender Absen</title>
    <style>
        /* Existing styles */
        .overtime-options {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        .overtime-options button {
            margin: 5px;
            padding: 10px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .overtime-options button:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <!-- Existing HTML -->
    <div id="calendar" class="calendar"></div>
    <div class="footer">
        <p id="total-earnings">Total pendapatan: Rp 0</p>
    </div>

    <script>
        const calendarElement = document.getElementById('calendar');
        const workdaysCountElement = document.getElementById('workdays-count');
        const totalEarningsElement = document.getElementById('total-earnings');
        const prevMonthButton = document.getElementById('prev-month');
        const nextMonthButton = document.getElementById('next-month');
        const monthNameElement = document.getElementById('month-name');

        const dailyEarnings = 98431; // Pendapatan per hari kerja
        const overtimeRate = 19000; // Tarif lembur per jam

        let savedDate = localStorage.getItem('savedDate');
        let currentDate = savedDate ? new Date(JSON.parse(savedDate)) : new Date();

        const savedWorkdays = JSON.parse(localStorage.getItem('workdays')) || {};
        const nationalHolidays = JSON.parse(localStorage.getItem('nationalHolidays')) || {};

        const monthNames = [
            "Januari", "Februari", "Maret", "April", "Mei", "Juni",
            "Juli", "Agustus", "September", "Oktober", "November", "Desember"
        ];

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDayIndex = new Date(year, month, 1).getDay();

            calendarElement.innerHTML = '';
            monthNameElement.textContent = `${monthNames[month]} ${year}`;

            const today = new Date();
            const isTodayInCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

            for (let i = 0; i < firstDayIndex; i++) {
                const emptyElement = document.createElement('div');
                calendarElement.appendChild(emptyElement);
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.classList.add('day');
                dayElement.textContent = `${day}`;

                const key = `${year}-${month}-${day}`;

                if (savedWorkdays[key]) {
                    dayElement.classList.add('workday');
                }

                dayElement.addEventListener('click', () => {
                    if (savedWorkdays[key]) {
                        if (confirm('Apakah Anda yakin ingin membatalkan absen untuk hari ini?')) {
                            delete savedWorkdays[key];
                            dayElement.classList.remove('workday');
                        }
                    } else {
                        const optionsContainer = document.createElement('div');
                        optionsContainer.classList.add('overtime-options');

                        const normalButton = document.createElement('button');
                        normalButton.textContent = 'Normal';
                        normalButton.onclick = () => {
                            savedWorkdays[key] = { type: 'normal' };
                            dayElement.classList.add('workday');
                            localStorage.setItem('workdays', JSON.stringify(savedWorkdays));
                            updateWorkdaysCount();
                            document.body.removeChild(optionsContainer);
                        };

                        const lemburButton = document.createElement('button');
                        lemburButton.textContent = 'Lembur';
                        lemburButton.onclick = () => {
                            const hours = parseInt(prompt('Masukkan jumlah jam lembur:'), 10);
                            if (!isNaN(hours) && hours > 0) {
                                savedWorkdays[key] = { type: 'lembur', hours: hours };
                                dayElement.classList.add('workday');
                                localStorage.setItem('workdays', JSON.stringify(savedWorkdays));
                                updateWorkdaysCount();
                            } else {
                                alert('Masukan jam lembur tidak valid.');
                            }
                            document.body.removeChild(optionsContainer);
                        };

                        optionsContainer.appendChild(normalButton);
                        optionsContainer.appendChild(lemburButton);
                        document.body.appendChild(optionsContainer);
                    }
                });

                calendarElement.appendChild(dayElement);
            }
            updateWorkdaysCount();
        }

        function updateWorkdaysCount() {
            const count = Object.keys(savedWorkdays).length;
            workdaysCountElement.textContent = `Hari kerja: ${count}`;
        }

        renderCalendar();
    </script>
</body>
</html>
