<script>
    const calendarElement = document.getElementById('calendar');
    const workdaysCountElement = document.getElementById('workdays-count');
    const prevMonthButton = document.getElementById('prev-month');
    const nextMonthButton = document.getElementById('next-month');
    const monthNameElement = document.getElementById('month-name');

    // Memuat tanggal saat ini
    let currentDate = new Date();

    // Memuat hari kerja dan hari libur dari localStorage
    const savedWorkdays = JSON.parse(localStorage.getItem('workdays')) || {};
    const nationalHolidays = JSON.parse(localStorage.getItem('nationalHolidays')) || {};

    const monthNames = [
        "Januari", "Februari", "Maret", "April", "Mei", "Juni",
        "Juli", "Agustus", "September", "Oktober", "November", "Desember"
    ];

    // Mengecek apakah tanggal tertentu adalah hari libur
    function isHoliday(year, month, day) {
        const date = new Date(year, month, day);
        return date.getDay() === 0 || nationalHolidays[`${year}-${month}-${day}`]; // Minggu atau hari libur nasional
    }

    // Fungsi untuk merender kalender
    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const firstDayIndex = new Date(year, month, 1).getDay();

        calendarElement.innerHTML = '';
        monthNameElement.textContent = `${monthNames[month]} ${year}`;

        const today = new Date();
        const isTodayInCurrentMonth = today.getFullYear() === year && today.getMonth() === month;

        // Tambahkan kotak kosong untuk hari sebelum tanggal 1
        for (let i = 0; i < firstDayIndex; i++) {
            const emptyElement = document.createElement('div');
            calendarElement.appendChild(emptyElement);
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dayElement = document.createElement('div');
            dayElement.classList.add('day');
            dayElement.textContent = `${day}`;

            const key = `${year}-${month}-${day}`;

            // Tambahkan kelas hari libur jika itu adalah hari libur
            if (isHoliday(year, month, day)) {
                dayElement.classList.add('holiday');
            }

            // Tambahkan kelas hari kerja jika disimpan
            if (savedWorkdays[key]) {
                dayElement.classList.add('workday');
            }

            // Tambahkan kelas hari ini jika tanggal adalah hari ini
            if (isTodayInCurrentMonth && day === today.getDate()) {
                dayElement.classList.add('today');
            }

            // Toggle hari kerja ketika diklik
            dayElement.addEventListener('click', () => {
                if (savedWorkdays[key]) {
                    delete savedWorkdays[key];
                    dayElement.classList.remove('workday');
                } else {
                    savedWorkdays[key] = true;
                    dayElement.classList.add('workday');
                }
                localStorage.setItem('workdays', JSON.stringify(savedWorkdays));
                updateWorkdaysCount();
            });

            // Toggle hari libur ketika klik kanan
            dayElement.addEventListener('contextmenu', (event) => {
                event.preventDefault();
                if (nationalHolidays[key]) {
                    delete nationalHolidays[key];
                    dayElement.classList.remove('holiday');
                } else {
                    nationalHolidays[key] = true;
                    dayElement.classList.add('holiday');
                }
                localStorage.setItem('nationalHolidays', JSON.stringify(nationalHolidays));
            });

            calendarElement.appendChild(dayElement);
        }

        updateWorkdaysCount();
    }

    // Menghitung jumlah hari kerja
    function updateWorkdaysCount() {
        const count = Object.keys(savedWorkdays).filter(key => {
            const [year, month] = key.split('-').map(Number);
            return year === currentDate.getFullYear() && month === currentDate.getMonth();
        }).length;
        workdaysCountElement.textContent = `Hari kerja: ${count}`;
    }

    // Event listener untuk tombol bulan sebelumnya
    prevMonthButton.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() - 1);
        renderCalendar();
    });

    // Event listener untuk tombol bulan berikutnya
    nextMonthButton.addEventListener('click', () => {
        currentDate.setMonth(currentDate.getMonth() + 1);
        renderCalendar();
    });

    // Render kalender saat halaman dimuat
    renderCalendar();
</script>
